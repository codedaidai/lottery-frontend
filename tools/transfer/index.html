<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËΩ¨Ëµ†ÂàÜÊûêÁ≥ªÁªü</title>

    <!-- CDNÂºïÂÖ• -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <link rel="stylesheet" href="css/style.css">

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
    <div id="app">
        <el-container style="height: 100vh;">
            <!-- ‰æßËæπÊ†è -->
            <el-aside width="200px" style="background-color: #304156;">
                <div class="logo">
                    <h2>ËΩ¨Ëµ†ÂàÜÊûê</h2>
                </div>
                <el-menu
                    :default-active="currentMenu"
                    class="sidebar-menu"
                    background-color="#304156"
                    text-color="#bfcbd9"
                    active-text-color="#409EFF"
                    @select="handleMenuSelect">
                    <el-menu-item index="dashboard">
                        <span>üìä Êï∞ÊçÆÊ¶ÇËßà</span>
                    </el-menu-item>
                    <el-menu-item index="records">
                        <span>üìã ËΩ¨Ëµ†ËÆ∞ÂΩï</span>
                    </el-menu-item>
                    <el-menu-item index="user">
                        <span>üë§ Áî®Êà∑ÂàÜÊûê</span>
                    </el-menu-item>
                    <el-menu-item index="network">
                        <span>üèÜ ËΩ¨Ëµ†ÊéíË°å</span>
                    </el-menu-item>
                </el-menu>
            </el-aside>

            <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
            <el-container>
                <!-- È°∂ÈÉ®Ê†è -->
                <el-header style="background-color: #fff; border-bottom: 1px solid #e6e6e6;">
                    <div class="header-content">
                        <h3>{{ menuTitle }}</h3>
                        <div>
                            <el-tag type="success">ËøêË°å‰∏≠</el-tag>
                            <span style="margin-left: 10px; color: #909399;">API: {{ apiBase }}</span>
                        </div>
                    </div>
                </el-header>

                <!-- ‰∏ªÂÜÖÂÆπ -->
                <el-main>
                    <!-- Êï∞ÊçÆÊ¶ÇËßàÈ°µÈù¢ -->
                    <div v-if="currentMenu === 'dashboard'" class="dashboard">
                        <el-row :gutter="20" style="margin-bottom: 20px;">
                            <el-col :span="6">
                                <el-card shadow="hover" class="stat-card">
                                    <div class="stat-value">{{ dashboardData.stats.total_count }}</div>
                                    <div class="stat-label">ÊÄªËΩ¨Ëµ†Ê¨°Êï∞</div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card shadow="hover" class="stat-card">
                                    <div class="stat-value">{{ dashboardData.stats.total_items }}</div>
                                    <div class="stat-label">ÊÄªËΩ¨Ëµ†Áâ©ÂìÅ</div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card shadow="hover" class="stat-card">
                                    <div class="stat-value">{{ dashboardData.stats.total_users }}</div>
                                    <div class="stat-label">ÂèÇ‰∏éÁî®Êà∑Êï∞</div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card shadow="hover" class="stat-card">
                                    <div class="stat-value">¬•{{ dashboardData.stats.total_value }}</div>
                                    <div class="stat-label">ÊÄªËΩ¨Ëµ†‰ª∑ÂÄº</div>
                                </el-card>
                            </el-col>
                        </el-row>

                        <!-- ÊúÄÊñ∞ËΩ¨Ëµ†Âä®ÊÄÅ -->
                        <el-card shadow="hover" style="margin-bottom: 20px;">
                            <template #header>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-weight: bold;">‚ö° ÊúÄÊñ∞ËΩ¨Ëµ†Âä®ÊÄÅ</span>
                                    <el-tag type="info" size="small">ÊúÄËøë24Â∞èÊó∂</el-tag>
                                </div>
                            </template>
                            <el-timeline v-if="recentTransfers.length">
                                <el-timeline-item
                                    v-for="item in recentTransfers"
                                    :key="item.id"
                                    :timestamp="item.addtime_format"
                                    placement="top"
                                    :color="item.is_first_transfer ? '#f56c6c' : '#409eff'">
                                    <el-card>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <strong>{{ item.user_id }}:{{ item.sender_name }}</strong>
                                                <span style="color: #909399;">‚Üí</span>
                                                <strong>{{ item.give_user_id }}:{{ item.receiver_name }}</strong>
                                                <span style="color: #606266; margin-left: 10px;">ËΩ¨Ëµ†‰∫Ü {{ item.count }} ‰ª∂Áâ©ÂìÅ</span>
                                            </div>
                                            <div>
                                                <el-tag v-if="item.is_first_transfer" type="danger" size="small" effect="dark">
                                                    üéâ È¶ñÊ¨°ËΩ¨Ëµ†
                                                </el-tag>
                                                <el-tag type="warning" size="small" style="margin-left: 5px;">
                                                    ¬•{{ item.total_value }}
                                                </el-tag>
                                            </div>
                                        </div>
                                    </el-card>
                                </el-timeline-item>
                            </el-timeline>
                            <el-empty v-else description="ÊöÇÊó†ÊúÄÊñ∞Âä®ÊÄÅ" :image-size="80"></el-empty>
                        </el-card>

                        <el-row :gutter="20">
                            <el-col :span="12">
                                <el-card shadow="hover">
                                    <div id="trendChart" style="height: 350px;"></div>
                                </el-card>
                            </el-col>
                            <el-col :span="12">
                                <el-card shadow="hover">
                                    <div id="topUsersChart" style="height: 350px;"></div>
                                </el-card>
                            </el-col>
                        </el-row>
                    </div>

                    <!-- ËΩ¨Ëµ†ËÆ∞ÂΩïÈ°µÈù¢ -->
                    <div v-if="currentMenu === 'records'" class="records">
                        <el-card shadow="never" style="margin-bottom: 20px;">
                            <el-form :inline="true" :model="recordsFilter">
                                <el-form-item label="Áî®Êà∑ID">
                                    <el-input v-model="recordsFilter.user_id" placeholder="ËæìÂÖ•Áî®Êà∑ID" clearable style="width: 150px;"></el-input>
                                </el-form-item>
                                <el-form-item label="ËΩ¨Ëµ†ÊñπÂêë">
                                    <el-select v-model="recordsFilter.direction" placeholder="ÈÄâÊã©ÊñπÂêë" style="width: 120px;">
                                        <el-option label="ÂÖ®ÈÉ®" value=""></el-option>
                                        <el-option label="Ëµ†ÈÄÅ" value="send"></el-option>
                                        <el-option label="Êé•Êî∂" value="receive"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="Êó∂Èó¥ËåÉÂõ¥">
                                    <el-date-picker
                                        v-model="recordsFilter.dateRange"
                                        type="daterange"
                                        range-separator="Ëá≥"
                                        start-placeholder="ÂºÄÂßãÊó•Êúü"
                                        end-placeholder="ÁªìÊùüÊó•Êúü"
                                        value-format="YYYY-MM-DD">
                                    </el-date-picker>
                                </el-form-item>
                                <el-form-item label="Êï∞ÈáèËåÉÂõ¥">
                                    <el-input v-model="recordsFilter.min_count" placeholder="ÊúÄÂ∞è" style="width: 100px;"></el-input>
                                    <span style="margin: 0 5px;">-</span>
                                    <el-input v-model="recordsFilter.max_count" placeholder="ÊúÄÂ§ß" style="width: 100px;"></el-input>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="loadRecords">ÊêúÁ¥¢</el-button>
                                    <el-button @click="resetRecordsFilter">ÈáçÁΩÆ</el-button>
                                    <el-button type="success" @click="exportExcel">ÂØºÂá∫Excel</el-button>
                                </el-form-item>
                            </el-form>
                        </el-card>

                        <el-card shadow="never">
                            <el-table
                                :data="recordsList"
                                v-loading="recordsLoading"
                                stripe
                                style="width: 100%;">
                                <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                <el-table-column label="Ëµ†ÈÄÅ‰∫∫" width="180">
                                    <template #default="scope">
                                        <div>
                                            {{ scope.row.user_id }}:{{ scope.row.sender_name }}
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Êé•Êî∂‰∫∫" width="180">
                                    <template #default="scope">
                                        <div>
                                            {{ scope.row.give_user_id }}:{{ scope.row.receiver_name }}
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="count" label="ËΩ¨Ëµ†Êï∞Èáè" width="100"></el-table-column>
                                <el-table-column label="ÊÄª‰ª∑ÂÄº" width="120">
                                    <template #default="scope">
                                        <el-tag type="warning">¬•{{ scope.row.total_value }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Áä∂ÊÄÅ" width="150">
                                    <template #default="scope">
                                        <div style="display: flex; flex-direction: column; gap: 5px;">
                                            <el-tag v-if="scope.row.is_first_transfer" type="danger" effect="dark" size="small">
                                                üéâ È¶ñÊ¨°ËΩ¨Ëµ†
                                            </el-tag>
                                            <el-tag v-if="scope.row.is_recent" type="success" effect="dark" size="small">
                                                ‚ö° ÊúÄÊñ∞Âä®ÊÄÅ
                                            </el-tag>
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="addtime_format" label="ËΩ¨Ëµ†Êó∂Èó¥" width="180"></el-table-column>
                                <el-table-column label="Êìç‰Ωú" width="100">
                                    <template #default="scope">
                                        <el-button link type="primary" @click="showRecordDetail(scope.row.id)">ËØ¶ÊÉÖ</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <el-pagination
                                style="margin-top: 20px; text-align: right;"
                                v-model:current-page="recordsPage"
                                v-model:page-size="recordsLimit"
                                :total="recordsTotal"
                                layout="total, prev, pager, next"
                                @current-change="loadRecords">
                            </el-pagination>
                        </el-card>

                        <!-- ËØ¶ÊÉÖÂºπÁ™ó -->
                        <el-dialog v-model="detailVisible" title="ËΩ¨Ëµ†ËØ¶ÊÉÖ" width="700px">
                            <div v-if="currentDetail">
                                <el-descriptions :column="2" border>
                                    <el-descriptions-item label="ËΩ¨Ëµ†ID">{{ currentDetail.id }}</el-descriptions-item>
                                    <el-descriptions-item label="ËΩ¨Ëµ†Êó∂Èó¥">{{ currentDetail.addtime_format }}</el-descriptions-item>
                                    <el-descriptions-item label="Ëµ†ÈÄÅ‰∫∫">{{ currentDetail.user_id }}:{{ currentDetail.sender_name }}</el-descriptions-item>
                                    <el-descriptions-item label="Êé•Êî∂‰∫∫">{{ currentDetail.give_user_id }}:{{ currentDetail.receiver_name }}</el-descriptions-item>
                                    <el-descriptions-item label="ËΩ¨Ëµ†Êï∞Èáè">{{ currentDetail.count }}‰ª∂</el-descriptions-item>
                                </el-descriptions>

                                <h4 style="margin-top: 20px; margin-bottom: 10px;">ËΩ¨Ëµ†Áâ©ÂìÅÊòéÁªÜ</h4>
                                <el-table :data="currentDetail.items" border style="width: 100%;">
                                    <el-table-column prop="goodslist_title" label="Áâ©ÂìÅÂêçÁß∞" min-width="200"></el-table-column>
                                    <el-table-column prop="prize_num" label="Êï∞Èáè" width="80" align="center"></el-table-column>
                                    <el-table-column label="Âçï‰ª∑" width="120" align="right">
                                        <template #default="scope">¬•{{ scope.row.goodslist_money }}</template>
                                    </el-table-column>
                                    <el-table-column label="Â∞èËÆ°" width="120" align="right">
                                        <template #default="scope">¬•{{ (scope.row.goodslist_money * scope.row.prize_num).toFixed(2) }}</template>
                                    </el-table-column>
                                </el-table>
                            </div>
                        </el-dialog>
                    </div>

                    <!-- Áî®Êà∑ÂàÜÊûêÈ°µÈù¢ -->
                    <div v-if="currentMenu === 'user'" class="user-analysis">
                        <el-card shadow="never" style="margin-bottom: 20px;">
                            <el-form :inline="true">
                                <el-form-item label="Áî®Êà∑ID">
                                    <el-input v-model="userAnalysisId" placeholder="ËæìÂÖ•Áî®Êà∑ID" style="width: 200px;"></el-input>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="loadUserAnalysis">Êü•ËØ¢</el-button>
                                </el-form-item>
                            </el-form>
                        </el-card>

                        <div v-if="userStats.user_info" v-loading="userLoading">
                            <el-card shadow="never" style="margin-bottom: 20px;">
                                <el-descriptions :column="3" border>
                                    <el-descriptions-item label="Áî®Êà∑" :span="2">{{ userStats.user_info.id }}:{{ userStats.user_info.nickname }}</el-descriptions-item>
                                    <el-descriptions-item label=""></el-descriptions-item>
                                    <el-descriptions-item label="ÂèëÂá∫Ê¨°Êï∞">{{ userStats.send.count }}Ê¨°</el-descriptions-item>
                                    <el-descriptions-item label="ÂèëÂá∫Áâ©ÂìÅ">{{ userStats.send.items }}‰ª∂</el-descriptions-item>
                                    <el-descriptions-item label="ÂèëÂá∫‰ª∑ÂÄº">¬•{{ userStats.send.value }}</el-descriptions-item>
                                    <el-descriptions-item label="Êî∂Âà∞Ê¨°Êï∞">{{ userStats.receive.count }}Ê¨°</el-descriptions-item>
                                    <el-descriptions-item label="Êî∂Âà∞Áâ©ÂìÅ">{{ userStats.receive.items }}‰ª∂</el-descriptions-item>
                                    <el-descriptions-item label="Êî∂Âà∞‰ª∑ÂÄº">¬•{{ userStats.receive.value }}</el-descriptions-item>
                                </el-descriptions>
                            </el-card>

                            <!-- Áî®Êà∑ËΩ¨Ëµ†ÂÖ≥Á≥ªÁΩëÁªúÂõæ -->
                            <el-card shadow="hover" style="margin-bottom: 20px;">
                                <h4>ËΩ¨Ëµ†ÂÖ≥Á≥ªÁΩëÁªú</h4>
                                <p style="color: #909399; font-size: 12px; margin-bottom: 10px;">
                                    ‰ª•ËØ•Áî®Êà∑‰∏∫‰∏≠ÂøÉÁöÑËΩ¨Ëµ†ÂÖ≥Á≥ªÁΩëÁªúÔºåËìùËâ≤Ë°®Á§∫ÂèëÂá∫ÔºåÁªøËâ≤Ë°®Á§∫Êî∂Âà∞
                                </p>
                                <div id="userNetworkChart" style="height: 500px;"></div>
                            </el-card>

                            <el-row :gutter="20">
                                <el-col :span="12">
                                    <el-card shadow="hover">
                                        <div id="userTrendChart" style="height: 350px;"></div>
                                    </el-card>
                                </el-col>
                                <el-col :span="12">
                                    <el-card shadow="hover">
                                        <div id="topReceiversChart" style="height: 350px;"></div>
                                    </el-card>
                                </el-col>
                            </el-row>

                            <!-- ËΩ¨Âá∫ÊòéÁªÜË°®Ê†º -->
                            <el-card shadow="hover" style="margin-top: 20px;">
                                <template #header>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="font-weight: bold;">üì§ ËΩ¨Âá∫ÊòéÁªÜ</span>
                                        <el-tag type="info" size="small">ËØ•Áî®Êà∑ËΩ¨Ëµ†Áªô‰ªñ‰∫∫</el-tag>
                                    </div>
                                </template>
                                <el-table :data="userStats.send_detail_list || []" stripe style="width: 100%;" max-height="400">
                                    <el-table-column type="index" label="Â∫èÂè∑" width="60"></el-table-column>
                                    <el-table-column label="Êé•Êî∂‰∫∫" min-width="200">
                                        <template #default="scope">
                                            <span style="color: #67C23A; font-weight: 500;">
                                                {{ scope.row.target_user_id }}:{{ scope.row.target_name }}
                                            </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="count" label="ËΩ¨Ëµ†Ê¨°Êï∞" width="120">
                                        <template #default="scope">
                                            <el-tag type="danger" size="small">{{ scope.row.count }}Ê¨°</el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="items" label="Áâ©ÂìÅÊï∞" width="100">
                                        <template #default="scope">{{ scope.row.items }}‰ª∂</template>
                                    </el-table-column>
                                    <el-table-column label="ËΩ¨Ëµ†ÈáëÈ¢ù" width="150">
                                        <template #default="scope">
                                            <el-tag type="warning" size="small">¬•{{ scope.row.value }}</el-tag>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </el-card>

                            <!-- ËΩ¨ÂÖ•ÊòéÁªÜË°®Ê†º -->
                            <el-card shadow="hover" style="margin-top: 20px;">
                                <template #header>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="font-weight: bold;">üì• ËΩ¨ÂÖ•ÊòéÁªÜ</span>
                                        <el-tag type="success" size="small">ËØ•Áî®Êà∑Êé•Êî∂‰ªñ‰∫∫ËΩ¨Ëµ†</el-tag>
                                    </div>
                                </template>
                                <el-table :data="userStats.receive_detail_list || []" stripe style="width: 100%;" max-height="400">
                                    <el-table-column type="index" label="Â∫èÂè∑" width="60"></el-table-column>
                                    <el-table-column label="Ëµ†ÈÄÅ‰∫∫" min-width="200">
                                        <template #default="scope">
                                            <span style="color: #409EFF; font-weight: 500;">
                                                {{ scope.row.source_user_id }}:{{ scope.row.source_name }}
                                            </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="count" label="ËΩ¨Ëµ†Ê¨°Êï∞" width="120">
                                        <template #default="scope">
                                            <el-tag type="danger" size="small">{{ scope.row.count }}Ê¨°</el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="items" label="Áâ©ÂìÅÊï∞" width="100">
                                        <template #default="scope">{{ scope.row.items }}‰ª∂</template>
                                    </el-table-column>
                                    <el-table-column label="ËΩ¨Ëµ†ÈáëÈ¢ù" width="150">
                                        <template #default="scope">
                                            <el-tag type="warning" size="small">¬•{{ scope.row.value }}</el-tag>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </el-card>
                        </div>

                        <el-empty v-else description="ËØ∑ËæìÂÖ•Áî®Êà∑IDÊü•ËØ¢" :image-size="100"></el-empty>
                    </div>

                    <!-- ËΩ¨Ëµ†ÊéíË°åÈ°µÈù¢ -->
                    <div v-if="currentMenu === 'network'" class="network">
                        <el-card shadow="never" style="margin-bottom: 20px;">
                            <el-form :inline="true">
                                <el-form-item label="ÊúÄÂ∞èËΩ¨Ëµ†Ê¨°Êï∞">
                                    <el-input-number v-model="networkMinCount" :min="1" :max="100"></el-input-number>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="loadNetwork">Êü•ËØ¢</el-button>
                                </el-form-item>
                            </el-form>
                        </el-card>

                        <!-- ËØ¶ÁªÜÊï∞ÊçÆË°®Ê†º -->
                        <el-card shadow="never" v-loading="networkLoading">
                            <h4>È´òÈ¢ëËΩ¨Ëµ†ÊéíË°å TOP50</h4>
                            <p style="color: #909399; font-size: 12px; margin-bottom: 10px;">
                                ÁªüËÆ°ÂçïÂêëËΩ¨Ëµ†ÂÖ≥Á≥ªÔºåÊåâËΩ¨Ëµ†Ê¨°Êï∞‰ªéÈ´òÂà∞‰ΩéÊéíÂ∫è
                            </p>
                            <el-table :data="networkPairs" stripe style="width: 100%; margin-top: 10px;">
                                <el-table-column type="index" label="ÊéíÂêç" width="80"></el-table-column>
                                <el-table-column label="Ëµ†ÈÄÅ‰∫∫" width="220">
                                    <template #default="scope">
                                        <span style="color: #409EFF; font-weight: 500;">
                                            {{ scope.row.sender_id }}:{{ scope.row.sender_name }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="" width="60" align="center">
                                    <template>
                                        <span style="color: #909399; font-size: 18px;">‚Üí</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Êé•Êî∂‰∫∫" width="220">
                                    <template #default="scope">
                                        <span style="color: #67C23A; font-weight: 500;">
                                            {{ scope.row.receiver_id }}:{{ scope.row.receiver_name }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="transfer_count" label="ËΩ¨Ëµ†Ê¨°Êï∞" width="120">
                                    <template #default="scope">
                                        <el-tag type="danger">{{ scope.row.transfer_count }}Ê¨°</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="total_items" label="Áâ©ÂìÅÊï∞" width="100"></el-table-column>
                                <el-table-column label="ËΩ¨Ëµ†ÈáëÈ¢ù" width="150">
                                    <template #default="scope">
                                        <el-tag type="warning">¬•{{ scope.row.total_value }}</el-tag>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-card>
                    </div>
                </el-main>
            </el-container>
        </el-container>
    </div>

    <!-- ÂºïÂÖ•JS -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
